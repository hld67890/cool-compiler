# PA1报告

刘明君18307130064

韩晓宇

## 任务二

### 构造测试用例

首先通过 `make dotest` 测试 `test.cl` 的解析结果。之后构造更多测试样例验证代码的正确性。由于会有比较多的测试，我们先写了一个 `checker.py` 来进行自动化测试，可以将 `tests` 文件夹的所有文件都使用 `bin/lexer` 和我们的解析器进行解析，之后判断是否相同。 

我们自行构造了若干测试用例，具体描述如下，同时还在网上找了一些测试输入。

下面 ` string` 中表示文件内容，可见字符直接表示，不可见字符通过形如 `\x0` 的方式表示，出现的字符串 `long` 在文件中表示 256 个 `long` 字符串。

#### 1.cl

一个很长的串，一些 `\0`,`\\0`,`\\\0` 相关的串。

几个 `>=` 一类的二元符号。

文件结尾有个转义掉的 `\n`，接着EOF。

### EOF

EOF系列的文件末尾都没有 `\n`

#### eof1.cl

`--` 应该正常结束，不报错

#### eof2.cl

`"` 字符串中包含EOF。

#### eof3.cl

`"\` 报错字符 `\` 不能出现在文件末尾，即包含被转义过的 EOF（handout里面没提到）。

#### eof4.cl

`\` 报错未知符号。

#### eof5.cl

`-`  只有一个减号。

#### eof6.cl

`(*` 报错多行注释包含EOF。

#### eof7.cl

`"\x0""` 报错两个字符串分别包含空字符和EOF。

#### eof8.cl

`"\x0"` 报错字符串包含空字符。

#### eof9.cl

`"\x0\"` 报错字符串包含空字符，这里同时出现了多种错误，应输出第一个遇到的错误。

#### eof10.cl

`"long\` 报错字符串过长，这里同时出现了多种，应输出第一个遇到的错误。

#### error4.1.cl

键盘中数字键上面的特殊字符

`"long"`,`"long`,`"long\"` 这里都输出字符串过长。

`*) *) **) **)) )* ))* )**)  * ) ) *`

#### error4.1_2.cl

`"long\"asd"` 这里过长之后有一个转义后的 `"` 需要吸收掉，只输出一个过长的串。这里最开始写的时候进入了错误字符串就无条件只看下一个 `"` 了，是有问题的。

#### error4.1_3.cl

`"long\"asd"`,`"long\n\"asd"`,`"long\\asd"`,`"long\\"asd"`,`"long\\\"asd"`,`"long\\"asd"`

前三行过长，第四行过长，之后 `asd` 的 object，未结束的字符串。第五行过长

#### error4.1_4.cl

过长的串之后有些转义后的 `\x16`（换行符）。

#### let_stmt.cl

`LET_STMT`，`let_stmt` 不特殊处理。 

#### null1.cl

`\x0\x0cs\x0\x0\sca` 未知字符 `\x0`

#### null2.cl

`"\x0\x0cs\x0\x0\sca"` 字符串里有空字符。

#### null3.cl

一些不超过最长长度但是包含空字符的串。

#### null4.cl

开头就有空字符的串。

#### null5.cl

开头就有空字符的超长串。

#### null6.cl

超长，末尾有空字符，并且没有结束 `"` 的串。

#### null7.cl

超长，末尾有空字符，并且没有结束 `"` 的串。

#### null8.cl

`"\\x0"` 输出转义过的空字符。（handout中没提到）

#### null9.cl

`"\\x0` 输出转义过的空字符。（handout中没提到）

#### right1.cl

一些关键字。

#### str1.cl

`\x0\x1\x2` 一直到 `\x127`。

#### str2.cl

引号中的 `\x0\x1\x2` 一直到 `\x127`。

#### str3.cl

 `"\\x0\\x1\\x2` 一直到 `\\x127` 但是没有后面的引号。

### 遇到的问题

在 `eof1.cl` 中单行注释如果遇到 EOF 应该正常结束，而不是报错，这里在理解manual时候发生了一些偏差。

`eof2.cl` 中如果想让一个字符串碰到 EOF 而报错的话，要么在行末加一个转义字符 `\`，要么使用程序来生成测试文件。因为正常的编辑器在保存文件时都会在文件的末尾增加一个换行符。

`eol3.cl` 中自然需要测试如果是 `"\` 而文件末尾没有换行符的情况，这时需要输出”`\` 出现在文件末尾“错误，这是 manual里面没有提到的。

`error4.1_2.cl` 中，字符串过长以后，我们的实现方式是进入一个 `STRbad` 的状态，并且吸收掉后面的字符，直到碰到 `"` 或者换行，这里如果 `"` 实际是一个被转义的引号，就不能结束这个字符串。也就是说字符串报错之后也需要正常处理转义的情况。

`null8.cl` 中测试了被转义的空字符 `\\x0`，这里需要报错“遇到转义后的空字符”错误，这个也是 manual 里面没有提到的。（而且这两个空字符的情况报错的末尾有个句号，和 manual 里面说的不一样）

在网上找到的测试中，我们发现多行注释的逻辑是进行嵌套，而不是匹配第一个 `*)`。

